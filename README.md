# openapi-scripts

Scripts used in postprocessing OpenAPI document for ReDoc.

## Postprocess the JSON file generated by `bufbuild/buf`

### Dereference

Use [@apidevtools/json-schema-ref-parser](https://github.com/APIDevTools/json-schema-ref-parser) to dereference the auto-generated JSON file.

### Generate code sample

Use [openapi-snippet](https://github.com/ErikWittern/openapi-snippet) to generate code samples automatically.

### Convert the example and default values of integer type to int

A `int32` type `port` defined in the `.proto` file is:

```proto
int32 port = 1 [(grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
    format: "int32",
    default: "8080",
    example: "8080"
```

The default JSON generated by `bufbuild/buf` is:

```json
"port": {
  "type": "integer",
  "format": "int32",
  "example": 8080,
  "default": "8080"
}
```

`replaceint.js` replaces all integer values and the processed JSON file is:

```json
"port": {
  "type": "integer",
  "format": "int32",
  "example": 8080,
  "default": 8080
}
```

### Import Markdown files

Embed external Markdown file contents to the `info.description` auto-generated JSON file. See [Redoc documentation](https://redocly.com/docs/api-reference-docs/guides/embedded-markdown/) for more information.

### Apply JSON patch

Apply JSON patch to the auto-generated JSON file. See [RFC 6902](https://tools.ietf.org/html/rfc6902) for more information.

### Add tag group

Add an `x-tagGroups` field to the auto-generated JSON file and group all tags under that a specified tag. This field is a Redoc vendor extension. See [Redoc documentation](https://redocly.com/docs/redoc/redoc-vendor-extensions/#x-taggroups) for more information.
